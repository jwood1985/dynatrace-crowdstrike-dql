{"version":15,"variables":[{"key":"TenantID","type":"query","visible":true,"input":"fetch events\n| fieldsAdd `Tenant`=dt.system.environment\n| fields `Tenant`\n| limit 1","multiple":false,"defaultValue":"qof78400"},{"key":"HostFilter","type":"text","visible":true,"defaultValue":"ALL"},{"key":"RecentRestart","type":"query","visible":true,"input":"fetch dt.entity.process_group_instance\n| fieldsAdd pgi_name=entity.name\n| filter contains(pgi_name,\"crowdstrike\",caseSensitive:false)\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n        | fieldsAdd inbound_pgi=toString(called_by)\n        | fieldsAdd outbound_pgi=toString(calls)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:pgi_name, lookupField:pgi_name, prefix:\"process.\"\n\n  | lookup [\n        fetch dt.entity.host\n        | fieldsAdd host_name = entity.name\n        | fieldsAdd monitoringMode\n        | fieldsAdd osType\n        | fieldsAdd lifetime\n  ], sourceField:process.host_id, lookupField:id, prefix:\"host.\"\n\n  | fieldsAdd starttime=toLong(toTimestamp(lifetime[start]))\n  | filter host.osType==\"WINDOWS\"\n  \n  // Determine whether the server has been restarted in the last 24 hrs\n  | fieldsAdd recent_restart_24hr = toLong(toTimestamp(now())) - starttime\n\n  | fieldsAdd recent_restart=if(recent_restart_24hr<24*60*60*1000000000,\"YES\",else:\"NO\")\n\n  // Add in field to check for Bitlocker-related processes\n  | lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | filter contains(entity.name,\"bitlocker\",caseSensitive:false)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:process.host_id, lookupField:host_id, prefix:\"bitlocker.\"\n\n  | limit 10000\n  \n  // Apply filters\n  | fieldsAdd tenantId=$TenantID\n  | fieldsAdd host_filter=if($HostFilter==\"ALL\",\"\",else:$HostFilter)\n  | filter contains(host.host_name,host_filter,caseSensitive:false)\n\n  | fieldsAdd `Bitlocker Present?`=if(isNotNull(bitlocker.pgi_name),\"YES\",else:\"NO\")\n  | fieldsAdd host_link = concat(\"https://\",tenantId,\".apps.dynatrace.com/ui/apps/dynatrace.classic.hosts/ui/entity/\",host.id)\n  | fields `Host`=host.host_name, `Process Name`=pgi_name, `Host Link`=host_link, `Recently Restarted?`=recent_restart, `Bitlocker Present?`\n  | summarize count=count(), by:{`Recently Restarted?`}\n  | sort `Recently Restarted?` asc\n  | fields `Recently Restarted?`\n  ","multiple":true,"defaultValue":["YES","NO"]}],"tiles":{"0":{"type":"data","title":"CrowdStrike Impacted Host Details","query":"fetch dt.entity.process_group_instance\n| fieldsAdd pgi_name=entity.name\n| filter contains(pgi_name,\"crowdstrike\",caseSensitive:false)\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n        | fieldsAdd inbound_pgi=toString(called_by)\n        | fieldsAdd outbound_pgi=toString(calls)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:pgi_name, lookupField:pgi_name, prefix:\"process.\"\n\n  | lookup [\n        fetch dt.entity.host\n        | fieldsAdd host_name = entity.name\n        | fieldsAdd monitoringMode\n        | fieldsAdd osType\n        | fieldsAdd lifetime\n  ], sourceField:process.host_id, lookupField:id, prefix:\"host.\"\n\n  | fieldsAdd starttime=toLong(toTimestamp(lifetime[start]))\n  | filter host.osType==\"WINDOWS\"\n  \n  // Determine whether the server has been restarted in the last 24 hrs\n  | fieldsAdd recent_restart_24hr = toLong(toTimestamp(now())) - starttime\n\n  | fieldsAdd recent_restart=if(recent_restart_24hr<24*60*60*1000000000,\"YES\",else:\"NO\")\n\n  // Add in field to check for Bitlocker-related processes\n  | lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | filter contains(entity.name,\"bitlocker\",caseSensitive:false)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:process.host_id, lookupField:host_id, prefix:\"bitlocker.\"\n\n  | limit 10000\n  \n  // Apply filters\n  | fieldsAdd tenantId=$TenantID\n  | fieldsAdd host_filter=if($HostFilter==\"ALL\",\"\",else:$HostFilter)\n  | filter contains(host.host_name,host_filter,caseSensitive:false)\n  | filter in(recent_restart,$RecentRestart)\n\n  | fieldsAdd `Bitlocker Present?`=if(isNotNull(bitlocker.pgi_name),\"YES\",else:\"NO\")\n  | fieldsAdd host_link = concat(\"https://\",tenantId,\".apps.dynatrace.com/ui/apps/dynatrace.classic.hosts/ui/entity/\",host.id)\n  | fields `Host`=host.host_name, `Process Name`=pgi_name, `Host Link`=host_link, `Recently Restarted?`=recent_restart, `Bitlocker Present?`\n  | summarize count=count(), by:{`Host`, `Host Link`, `Bitlocker Present?`, `Recently Restarted?`}\n  | sort `Bitlocker Present?` asc\n  | fields `Host`, `Bitlocker Present?`, `Recently Restarted?`, `Host Link`","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Recently Restarted?","title":"","isEnabled":true,"rules":[{"id":0,"color":"#960000","comparator":"=","label":"","value":"NO"},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-09-default, #649438)"},"comparator":"=","label":"","value":"YES"},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"=","label":""}]},{"id":2,"field":"Bitlocker Present?","title":"","isEnabled":true,"rules":[{"id":0,"color":"#960000","comparator":"=","label":"","value":"YES"},{"id":1,"color":"#62903C","comparator":"=","label":"","value":"NO"},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"=","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxisLabel":"Host","valueAxisLabel":"count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"Host","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"Host Link\"]":730},"sortBy":{"columnId":"[\"Bitlocker Present?\"]","direction":"descending"},"colorThresholdTarget":"background"},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"Host","value":"Bitlocker Present?"}},"histogram":{"dataMappings":[]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"1":{"type":"markdown","title":"","content":"[Remediation guidelines from CrowdStrike](https://www.crowdstrike.com/falcon-content-update-remediation-and-guidance-hub/)\n\n\nAll servers selected here are running _Windows_ and have CrowdStrike processes running/recently active within the time shown in the time selector (upper lefthand side).\n* You may need to refresh `TenantID` to show your current Dynatrace SaaS tenant.\n* Use `HostFilter` to search for hosts by their names. This field is a wildcard.\n* Use `RecentRestart` to select servers that have been restarted in the past 24 hrs. This can help prioritize remediation.\n* Right-click on `Host Link` and select `Open Link` to drill into more details about the host in question.\n* If you see a prompt that states `Define a value in the referenced variable: Recent Restart` or `There are no records`, then you do not have any servers affected."},"3":{"type":"data","title":"","query":"fetch dt.entity.process_group_instance\n| fieldsAdd pgi_name=entity.name\n| filter contains(pgi_name,\"crowdstrike\",caseSensitive:false)\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n        | fieldsAdd inbound_pgi=toString(called_by)\n        | fieldsAdd outbound_pgi=toString(calls)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:pgi_name, lookupField:pgi_name, prefix:\"process.\"\n\n  | lookup [\n        fetch dt.entity.host\n        | fieldsAdd host_name = entity.name\n        | fieldsAdd monitoringMode\n        | fieldsAdd osType\n        | fieldsAdd lifetime\n  ], sourceField:process.host_id, lookupField:id, prefix:\"host.\"\n\n  | fieldsAdd starttime=toLong(toTimestamp(lifetime[start]))\n  | filter host.osType==\"WINDOWS\"\n  \n  // Determine whether the server has been restarted in the last 24 hrs\n  | fieldsAdd recent_restart_24hr = toLong(toTimestamp(now())) - starttime\n\n  | fieldsAdd recent_restart=if(recent_restart_24hr<24*60*60*1000000000,\"YES\",else:\"NO\")\n\n  // Add in field to check for Bitlocker-related processes\n  | lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | filter contains(entity.name,\"bitlocker\",caseSensitive:false)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:process.host_id, lookupField:host_id, prefix:\"bitlocker.\"\n\n  | limit 10000\n  \n  // Apply filters\n  | fieldsAdd tenantId=$TenantID\n  | fieldsAdd host_filter=if($HostFilter==\"ALL\",\"\",else:$HostFilter)\n  | filter contains(host.host_name,host_filter,caseSensitive:false)\n  | filter in(recent_restart,$RecentRestart)\n\n  | fieldsAdd `Bitlocker Present?`=if(isNotNull(bitlocker.pgi_name),\"YES\",else:\"NO\")\n  | fieldsAdd host_link = concat(\"https://\",tenantId,\".apps.dynatrace.com/ui/apps/dynatrace.classic.hosts/ui/entity/\",host.id)\n  | fields `Host`=host.host_name, `Process Name`=pgi_name, `Host Link`=host_link, `Recently Restarted?`=recent_restart, `Bitlocker Present?`\n  | summarize count=count(), by:{`Host`, `Host Link`, `Bitlocker Present?`, `Recently Restarted?`}\n  | sort `Bitlocker Present?` asc\n  | fields `Host`, `Bitlocker Present?`, `Recently Restarted?`, `Host Link`\n  | summarize `Host Count`=countDistinct(`Host`)\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"Host Count","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"comparator":">","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-09-default, #649438)"},"comparator":"=","label":"","value":"YES"},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"=","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxisLabel":"Host","valueAxisLabel":"count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"HostsIcon","recordField":"Host Count","autoscale":true,"alignment":"center","colorThresholdTarget":"background"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"Host Link\"]":730},"sortBy":{"columnId":"[\"Recently Restarted?\"]","direction":"descending"},"colorThresholdTarget":"background"},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{}},"histogram":{"dataMappings":[{"valueAxis":"Host Count","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"4":{"type":"data","title":"","query":"fetch dt.entity.process_group_instance\n| fieldsAdd pgi_name=entity.name\n| filter contains(pgi_name,\"crowdstrike\",caseSensitive:false)\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n        | fieldsAdd inbound_pgi=toString(called_by)\n        | fieldsAdd outbound_pgi=toString(calls)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:pgi_name, lookupField:pgi_name, prefix:\"process.\"\n\n  | lookup [\n        fetch dt.entity.host\n        | fieldsAdd host_name = entity.name\n        | fieldsAdd monitoringMode\n        | fieldsAdd osType\n        | fieldsAdd lifetime\n  ], sourceField:process.host_id, lookupField:id, prefix:\"host.\"\n\n  | fieldsAdd starttime=toLong(toTimestamp(lifetime[start]))\n  | filter host.osType==\"WINDOWS\"\n  \n  // Determine whether the server has been restarted in the last 24 hrs\n  | fieldsAdd recent_restart_24hr = toLong(toTimestamp(now())) - starttime\n\n  | fieldsAdd recent_restart=if(recent_restart_24hr<24*60*60*1000000000,\"YES\",else:\"NO\")\n\n  // Add in field to check for Bitlocker-related processes\n  | lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd host_id=belongs_to[dt.entity.host]\n        | filter contains(entity.name,\"bitlocker\",caseSensitive:false)\n        | fieldsAdd pgi_name = entity.name\n\t], sourceField:process.host_id, lookupField:host_id, prefix:\"bitlocker.\"\n\n  | limit 10000\n  \n  // Apply filters\n  | fieldsAdd tenantId=$TenantID\n  | fieldsAdd host_filter=if($HostFilter==\"ALL\",\"\",else:$HostFilter)\n  | filter contains(host.host_name,host_filter,caseSensitive:false)\n  | filter in(recent_restart,$RecentRestart)\n\n  | fieldsAdd `Bitlocker Present?`=if(isNotNull(bitlocker.pgi_name),\"YES\",else:\"NO\")\n  | fieldsAdd host_link = concat(\"https://\",tenantId,\".apps.dynatrace.com/ui/apps/dynatrace.classic.hosts/ui/entity/\",host.id)\n  | fields `Host`=host.host_name, `Process Name`=pgi_name, `Host Link`=host_link, `Recently Restarted?`=recent_restart, `Bitlocker Present?`\n  | summarize count=count(), by:{`Host`, `Host Link`, `Bitlocker Present?`, `Recently Restarted?`}\n  | sort `Bitlocker Present?` asc\n  | fields `Host`, `Bitlocker Present?`, `Recently Restarted?`, `Host Link`\n  \n  | filter `Recently Restarted?` == \"YES\"\n  | summarize `Recently Restarted Server Count`=countDistinct(`Host`)\n","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"Recently Restarted Server Count","title":"","isEnabled":true,"rules":[{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-09-default, #649438)"},"comparator":">","label":"","value":0},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"=","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxisLabel":"Recently Restarted?","valueAxisLabel":"Recently Restarted Server Count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"ActionIcon","recordField":"Recently Restarted Server Count","autoscale":true,"alignment":"center","colorThresholdTarget":"background"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"Host Link\"]":730},"sortBy":{"columnId":"[\"Recently Restarted?\"]","direction":"descending"},"colorThresholdTarget":"background"},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{}},"histogram":{"dataMappings":[{"valueAxis":"Recently Restarted Server Count","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}}},"layouts":{"0":{"x":0,"y":0,"w":18,"h":14},"1":{"x":18,"y":2,"w":6,"h":10},"3":{"x":18,"y":0,"w":3,"h":2},"4":{"x":21,"y":0,"w":3,"h":2}},"importedWithCode":false}
